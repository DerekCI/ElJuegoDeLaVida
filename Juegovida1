#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <unistd.h>


int** pideMatriz(int filas, int columnas);
void imprimeMatriz(int** matriz, int filas, int columnas);
void imprimeMatriz2(int** matriz, int filas, int columnas);
void imprimeMatriz3(int** matriz, int filas, int columnas);
int** checador(int **matriz, int **matriz2, int filas, int columnas);
int vecinasVivas(int** matriz, int, int);


int main()
{
    int filas , columnas;
	printf("Numero de filas de la matriz\n");
	scanf("%d",&filas);
	printf("Numero de columnas de la matriz\n");
	scanf("%d",&columnas);
	int **matriz = pideMatriz(filas, columnas);
	int **matriz2= pideMatriz(filas,columnas);
	system("clear");
	for (int i = 0; i < 6; ++i)
	{
		imprimeMatriz(matriz, filas, columnas);
		imprimeMatriz3(matriz,filas,columnas);
		printf("\n");
		imprimeMatriz2(matriz,filas,columnas);
		//matriz=checador(matriz,matriz2,filas,columnas);
		printf("___________________________________\n");
		matriz=checador(matriz,matriz2,filas,columnas);
		printf("0000000000000000000000000_\n");		
		sleep(2);
	}
	free(matriz);
	free(matriz2);
	return 0;
}

int** pideMatriz(int filas, int columnas)
{
	int i, j;
	int **matriz;

	srand(time(NULL));
	//regresa un arreglo de n elementos, cada elemento es un apuntador
	matriz = (int **)malloc(filas*sizeof(int*)); 
	//crea la matriz, hace un arreglo para cada elemento del arreglo inicial
	for(i=0; i<filas; i++) 
	{
		matriz[i] = (int *)malloc(columnas*sizeof(int));
	}
	
	for(i=0; i<filas; i++)
	{
		for(j=0; j<columnas; j++)
		{
			matriz[i][j] = rand() % 2;
		}
	}
	return matriz;
}

void imprimeMatriz(int** matriz, int filas, int columnas){
	int i, j;
	for(i=0; i < filas; i++)
	{
		for(j=0; j<columnas; j++)
		{
			if(matriz[i][j] == 1)
				printf("@ ");
			else
				printf(". ");
		}
		printf("\n");
	}
}
void imprimeMatriz3(int** matriz, int filas, int columnas){  //matriz de prueba, imprime los vecinos
	int i, j;
	for(i=0; i < filas; i++)
	{
		for(j=0; j<columnas; j++)
		{
			if(matriz[i][j] == 1)
				printf("%d",VVivas(matriz,filas,columnas,i,j));
			else
				printf("%d ",VVivas(matriz,filas,columnas,i,j));
		}
		printf("\n");
	}
}

void imprimeMatriz2(int** matriz, int filas, int columnas){ //matriz de prueba, imprime en 1 o 0
	int i, j;
	for(i=0; i < filas; i++)
	{
		for(j=0; j<columnas; j++)
		{
			if(matriz[i][j] == 1)
				printf("1 ");
			else
				printf("0 ");
		}
		printf("\n");
	}
}

int** checador(int **matriz, int **matriz2, int filas, int columnas)
{	
	int i,j;
    for(i = 0; i <filas; i++)
    {
        for(j = 0; j <columnas; j++) 
        { 
            if(matriz[i][j] == 0 && VVivas(matriz,filas,columnas,i, j) == 3) //si esta muerta y sig=vive
            {
                matriz2[i][j] = 1;
            }
            else if (matriz[i][j] == 0 && VVivas(matriz,filas,columnas,i, j)!=3)
            {
            	matriz2[i][j] = 0;
            }
            else if(matriz[i][j] == 1 && (VVivas(matriz,filas,columnas,i, j) == 3 || VVivas(matriz,filas,columnas,i, j)==2)) //si esta vive y sig=vive
            {
                matriz2[i][j] = 1;
            }
            else if(matriz[i][j] == 1 && (VVivas(matriz,filas,columnas,i, j) > 3 || VVivas(matriz,filas,columnas,i, j)<2))//si esta viva y sig= muere
            {
                matriz2[i][j] = 0;
            }
        }
    }
    return matriz2;
}

int VVivas(int **matriz, int filas, int columnas,int i,int j)
{
    int total = 0;
	int izq,cenx,ceny,der,arr,aba;
	cenx=j;
	ceny=i;
	izq=j-1;
	der=j+1;
	arr=i-1;
	aba=i+1;
	if(i==0 || i==filas-1 || j==0 || j==columnas-1)
	{
		if(i==0)
		{
			arr=0;	
		}
		if(i==filas-1)
		{
			aba=filas-1;
		}
		if(j==0)
		{
			izq=0;
		}
		if(j==columnas-1)
		{
			der=columnas-1;
		}

	}

    for(i = arr; i <= aba; i++)
    {
    	for(j = izq; j <= der; j++)
        {
            	if(cenx==j && ceny ==i)
            	{
            						//no suma si esta en el centro
            	}else
            	{
            		total += matriz[i][j];
            	}
        }
    }
	return total;
}
